{"ast":null,"code":"var express = require(\"express\");\n\nvar app = express();\nconst router = express.Router();\n\nvar bodyParser = require(\"body-parser\");\n\nvar session = require(\"express-session\");\n\nvar cookieParser = require(\"cookie-parser\");\n\nvar Validator = require(\"validator\");\n\nvar isEmpty = require(\"lodash/isEmpty\");\n\nconst mysql = require(\"mysql\");\n\nvar isEmpty = require(\"lodash/isEmpty\");\n\nconst bcrypt = require(\"bcryptjs\"); //const jwt = require(\"jsonwebtoken\");\n\n\nvar db = require(\"../dbseed\");\n\nvar validateUserSignupInput = require(\"../Validators/validateUserSignupInput\");\n\nrouter.post(\"/studentsignup\", async function (req, res) {\n  const {\n    errors,\n    isValid\n  } = validateUserSignupInput(req.body);\n\n  if (!isValid) {\n    console.log(errors);\n    res.status(400).send(errors);\n  } else {\n    console.log(\"Studentsignuprequest received\");\n    var encryptedPassword;\n\n    try {\n      encryptedPassword = await bcrypt.hash(req.body.password, 12);\n      console.log(encryptedPassword);\n    } catch (err) {\n      console.log(\"error with encryption\");\n    }\n\n    var sql = `INSERT INTO StudentData (studentfullname, email, password, schoolname) VALUES('${req.body.studentfullname}','${req.body.email}','${encryptedPassword}','${req.body.schoolname}')`;\n    db.query(sql, (err, rows, fields) => {\n      // if (err) throw err;\n      if (err) {\n        res.status(400).send(\"User ID/EMAIL already exist\");\n      } else {\n        // let token;\n        // try {\n        //   token = jwt.sign({ email: req.body.email }, \"SUPERSECRETPIN\", {\n        //     expiresIn: \"1h\"\n        //   });\n        // } catch {\n        //   console.log(\"error occured with token\");\n        //   res.send(400).send({ problem: token });\n        // }\n        console.log(\"1 record inserted\"); //res.status(200).send({ email: req.body.email, token: token });\n\n        res.status(200).send({\n          success: true\n        });\n      }\n    });\n    console.log(req.body); //else\n  } //main function\n\n});\nmodule.exports = router;","map":{"version":3,"sources":["/Users/surbhi/Documents/STUDY/CMPE273/Projects/Handshake/backend/Routes/studentsignup.js"],"names":["express","require","app","router","Router","bodyParser","session","cookieParser","Validator","isEmpty","mysql","bcrypt","db","validateUserSignupInput","post","req","res","errors","isValid","body","console","log","status","send","encryptedPassword","hash","password","err","sql","studentfullname","email","schoolname","query","rows","fields","success","module","exports"],"mappings":"AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,GAAG,GAAGF,OAAO,EAAjB;AACA,MAAMG,MAAM,GAAGH,OAAO,CAACI,MAAR,EAAf;;AACA,IAAIC,UAAU,GAAGJ,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAIK,OAAO,GAAGL,OAAO,CAAC,iBAAD,CAArB;;AACA,IAAIM,YAAY,GAAGN,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIO,SAAS,GAAGP,OAAO,CAAC,WAAD,CAAvB;;AACA,IAAIQ,OAAO,GAAGR,OAAO,CAAC,gBAAD,CAArB;;AACA,MAAMS,KAAK,GAAGT,OAAO,CAAC,OAAD,CAArB;;AACA,IAAIQ,OAAO,GAAGR,OAAO,CAAC,gBAAD,CAArB;;AACA,MAAMU,MAAM,GAAGV,OAAO,CAAC,UAAD,CAAtB,C,CACA;;;AAEA,IAAIW,EAAE,GAAGX,OAAO,CAAC,WAAD,CAAhB;;AACA,IAAIY,uBAAuB,GAAGZ,OAAO,CAAC,uCAAD,CAArC;;AAEAE,MAAM,CAACW,IAAP,CAAY,gBAAZ,EAA8B,gBAAeC,GAAf,EAAoBC,GAApB,EAAyB;AACrD,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAsBL,uBAAuB,CAACE,GAAG,CAACI,IAAL,CAAnD;;AACA,MAAI,CAACD,OAAL,EAAc;AACZE,IAAAA,OAAO,CAACC,GAAR,CAAYJ,MAAZ;AACAD,IAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,MAArB;AACD,GAHD,MAGO;AACLG,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACA,QAAIG,iBAAJ;;AACA,QAAI;AACFA,MAAAA,iBAAiB,GAAG,MAAMb,MAAM,CAACc,IAAP,CAAYV,GAAG,CAACI,IAAJ,CAASO,QAArB,EAA+B,EAA/B,CAA1B;AACAN,MAAAA,OAAO,CAACC,GAAR,CAAYG,iBAAZ;AACD,KAHD,CAGE,OAAOG,GAAP,EAAY;AACZP,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACD;;AACD,QAAIO,GAAG,GAAI,kFAAiFb,GAAG,CAACI,IAAJ,CAASU,eAAgB,MAAKd,GAAG,CAACI,IAAJ,CAASW,KAAM,MAAKN,iBAAkB,MAAKT,GAAG,CAACI,IAAJ,CAASY,UAAW,IAAzL;AAEAnB,IAAAA,EAAE,CAACoB,KAAH,CAASJ,GAAT,EAAc,CAACD,GAAD,EAAMM,IAAN,EAAYC,MAAZ,KAAuB;AACnC;AACA,UAAIP,GAAJ,EAAS;AACPX,QAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,6BAArB;AACD,OAFD,MAEO;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAH,QAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAXK,CAYL;;AACAL,QAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEY,UAAAA,OAAO,EAAE;AAAX,SAArB;AACD;AACF,KAnBD;AAqBAf,IAAAA,OAAO,CAACC,GAAR,CAAYN,GAAG,CAACI,IAAhB,EAhCK,CAiCL;AACD,GAvCoD,CAwCrD;;AACD,CAzCD;AA2CAiB,MAAM,CAACC,OAAP,GAAiBlC,MAAjB","sourcesContent":["var express = require(\"express\");\nvar app = express();\nconst router = express.Router();\nvar bodyParser = require(\"body-parser\");\nvar session = require(\"express-session\");\nvar cookieParser = require(\"cookie-parser\");\nvar Validator = require(\"validator\");\nvar isEmpty = require(\"lodash/isEmpty\");\nconst mysql = require(\"mysql\");\nvar isEmpty = require(\"lodash/isEmpty\");\nconst bcrypt = require(\"bcryptjs\");\n//const jwt = require(\"jsonwebtoken\");\n\nvar db = require(\"../dbseed\");\nvar validateUserSignupInput = require(\"../Validators/validateUserSignupInput\");\n\nrouter.post(\"/studentsignup\", async function(req, res) {\n  const { errors, isValid } = validateUserSignupInput(req.body);\n  if (!isValid) {\n    console.log(errors);\n    res.status(400).send(errors);\n  } else {\n    console.log(\"Studentsignuprequest received\");\n    var encryptedPassword;\n    try {\n      encryptedPassword = await bcrypt.hash(req.body.password, 12);\n      console.log(encryptedPassword);\n    } catch (err) {\n      console.log(\"error with encryption\");\n    }\n    var sql = `INSERT INTO StudentData (studentfullname, email, password, schoolname) VALUES('${req.body.studentfullname}','${req.body.email}','${encryptedPassword}','${req.body.schoolname}')`;\n\n    db.query(sql, (err, rows, fields) => {\n      // if (err) throw err;\n      if (err) {\n        res.status(400).send(\"User ID/EMAIL already exist\");\n      } else {\n        // let token;\n        // try {\n        //   token = jwt.sign({ email: req.body.email }, \"SUPERSECRETPIN\", {\n        //     expiresIn: \"1h\"\n        //   });\n        // } catch {\n        //   console.log(\"error occured with token\");\n        //   res.send(400).send({ problem: token });\n        // }\n\n        console.log(\"1 record inserted\");\n        //res.status(200).send({ email: req.body.email, token: token });\n        res.status(200).send({ success: true });\n      }\n    });\n\n    console.log(req.body);\n    //else\n  }\n  //main function\n});\n\nmodule.exports = router;\n"]},"metadata":{},"sourceType":"script"}